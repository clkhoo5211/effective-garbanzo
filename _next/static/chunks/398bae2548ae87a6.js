(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,84355,e=>{"use strict";let t,l;var r=e.i(43476),a=e.i(932),i=e.i(68834),n=e.i(46696),s=e.i(97005);async function o(e){if(!e)throw Error("Slug is required");let t={},l=await fetch(`/blogs/${encodeURIComponent(e)}/config.json`);if(l.ok)try{t=await l.json()}catch{t={}}let r=await fetch(`/blogs/${encodeURIComponent(e)}/index.md`);if(!r.ok)throw Error("Blog not found");return{slug:e,config:t,markdown:await r.text(),cover:t.cover}}let c={slug:"",title:"",md:"",tags:[],date:new Date().toISOString().slice(0,10),summary:""},d=(0,i.create)((e,t)=>({mode:"create",originalSlug:null,setMode:(t,l)=>e({mode:t,originalSlug:l||null}),form:{...c},updateForm:t=>e(e=>({form:{...e.form,...t}})),setForm:t=>e({form:t}),images:[],addUrlImage:l=>{let{images:r}=t();if(r.some(e=>"url"===e.type&&e.url===l))return void n.toast.info("该图片已在列表中");let a=Math.random().toString(36).slice(2,10);e(e=>({images:[{id:a,type:"url",url:l},...e.images]}))},addFiles:async l=>{let{images:r}=t(),a=Array.from(l).filter(e=>e.type.startsWith("image/"));if(0===a.length)return;let i=new Set(r.filter(e=>"file"===e.type&&e.hash).map(e=>e.hash)),o=await Promise.all(a.map(async e=>{let t=await (0,s.hashFileSHA256)(e);return{file:e,hash:t}})),c=new Set,d=o.filter(({hash:e})=>!(i.has(e)||c.has(e))&&(c.add(e),!0));if(0===d.length)return void n.toast.info("图片已存在，不重复添加");let u=d.map(({file:e,hash:t})=>{let l=Math.random().toString(36).slice(2,10),r=URL.createObjectURL(e),a=e.name;return{id:l,type:"file",file:e,previewUrl:r,filename:a,hash:t}});e(e=>({images:[...u,...e.images]}))},deleteImage:t=>e(l=>{for(let r of l.images)"file"===r.type&&r.id===t&&(URL.revokeObjectURL(r.previewUrl),r.id===l.cover?.id&&e({cover:null}));return{images:l.images.filter(e=>e.id!==t)}}),cover:null,setCover:t=>e({cover:t}),loading:!1,setLoading:t=>e({loading:t}),loadBlogForEdit:async t=>{try{let l;e({loading:!0});let r=await o(t),a=[],i=/!\[.*?\]\((.*?)\)/g;for(;null!==(l=i.exec(r.markdown));){let e=l[1];if(e&&e!==r.cover&&!e.startsWith("local-image:")&&!a.some(t=>"url"===t.type&&t.url===e)){let t=Math.random().toString(36).slice(2,10);a.push({id:t,type:"url",url:e})}}let s=null;r.cover&&(s={id:Math.random().toString(36).slice(2,10),type:"url",url:r.cover}),e({mode:"edit",originalSlug:t,form:{slug:t,title:r.config.title||"",md:r.markdown,tags:r.config.tags||[],date:r.config.date||new Date().toISOString().slice(0,10),summary:r.config.summary||""},images:a,cover:s,loading:!1}),n.toast.success("博客加载成功")}catch(t){throw console.error("Failed to load blog:",t),n.toast.error(t?.message||"加载博客失败"),e({loading:!1}),t}},reset:()=>{let{images:l,cover:r}=t();for(let e of l)"file"===e.type&&URL.revokeObjectURL(e.previewUrl);r?.type==="file"&&URL.revokeObjectURL(r.previewUrl),e({mode:"create",originalSlug:null,form:{...c,date:new Date().toISOString().slice(0,10)},images:[],cover:null})}})),u=(0,i.create)(e=>({isPreview:!1,openPreview:()=>e({isPreview:!0}),closePreview:()=>e({isPreview:!1}),togglePreview:()=>e(e=>({isPreview:!e.isPreview}))}));var m=e.i(46932),f=e.i(63580),g=e.i(71645);let h="text";function p(){let e,t,l,i,n,s,o,c,u,p,x,y,v=(0,a.c)(27),{form:b,updateForm:w}=d(),N=(0,g.useRef)(null);if(v[0]!==w){let t=e=>{let t=N.current;if(t&&(t.focus(),!document.execCommand("insertText",!1,e))){let{selectionStart:l,selectionEnd:r,value:a}=t;w({md:a.substring(0,l)+e+a.substring(r)}),setTimeout(()=>{t.setSelectionRange(l+e.length,l+e.length),t.focus()},0)}};e=e=>{let l=N.current;if(!l)return;let{selectionStart:r,selectionEnd:a,value:i}=l,n=i.substring(r,a);if((e.ctrlKey||e.metaKey)&&"b"===e.key){e.preventDefault();let s=i.substring(0,r),o=i.substring(a);if(s.endsWith("**")&&o.startsWith("**")&&n)l.setSelectionRange(r-2,a+2),t(n);else{let e=n||h;t(`**${e}**`),n||setTimeout(()=>{l.setSelectionRange(r+2,r+2+h.length)},0)}return}if((e.ctrlKey||e.metaKey)&&"i"===e.key){e.preventDefault();let s=i.substring(0,r),o=i.substring(a);if(s.endsWith("*")&&o.startsWith("*")&&!(s.endsWith("**")&&o.startsWith("**"))&&n)l.setSelectionRange(r-1,a+1),t(n);else{let e=n||h;t(`*${e}*`),n||setTimeout(()=>{l.setSelectionRange(r+1,r+1+h.length)},0)}return}if((e.ctrlKey||e.metaKey)&&"k"===e.key){e.preventDefault();let a=n||h;t(`[${a}](url)`),setTimeout(()=>{let e=r+a.length+3;l.setSelectionRange(e,e+3)},0);return}if("Tab"===e.key&&!e.shiftKey){e.preventDefault(),t("	");return}if("Tab"===e.key&&e.shiftKey){e.preventDefault();let a=i.lastIndexOf("\n",r-1)+1,n=i.substring(a,i.indexOf("\n",r));n.startsWith("	")?(l.setSelectionRange(a,a+1),t("")):n.startsWith("  ")&&(l.setSelectionRange(a,a+2),t(""));return}},v[0]=w,v[1]=e}else e=v[1];let I=e;return v[2]===Symbol.for("react.memo_cache_sentinel")?(t={opacity:0,scale:.8},l={opacity:1,scale:1},i={delay:f.INIT_DELAY},v[2]=t,v[3]=l,v[4]=i):(t=v[2],l=v[3],i=v[4]),v[5]!==w?(n=e=>w({title:e.target.value}),v[5]=w,v[6]=n):n=v[6],v[7]!==b.title||v[8]!==n?(s=(0,r.jsx)("input",{type:"text",placeholder:"标题",className:"flex-1 rounded-lg border bg-white/60 px-3 py-2 text-sm",value:b.title,onChange:n}),v[7]=b.title,v[8]=n,v[9]=s):s=v[9],v[10]!==w?(o=e=>w({slug:e.target.value}),v[10]=w,v[11]=o):o=v[11],v[12]!==b.slug||v[13]!==o?(c=(0,r.jsx)("input",{type:"text",placeholder:"slug（xx-xx）",className:"w-[200px] rounded-lg border bg-white/60 px-3 py-2 text-sm",value:b.slug,onChange:o}),v[12]=b.slug,v[13]=o,v[14]=c):c=v[14],v[15]!==s||v[16]!==c?(u=(0,r.jsxs)("div",{className:"mb-3 flex gap-3",children:[s,c]}),v[15]=s,v[16]=c,v[17]=u):u=v[17],v[18]!==w?(p=e=>w({md:e.target.value}),v[18]=w,v[19]=p):p=v[19],v[20]!==b.md||v[21]!==I||v[22]!==p?(x=(0,r.jsx)("textarea",{ref:N,placeholder:"Markdown 内容",className:"h-[650px] w-full flex-1 resize-none rounded-xl border bg-white/60 p-4 text-sm",value:b.md,onChange:p,onKeyDown:I}),v[20]=b.md,v[21]=I,v[22]=p,v[23]=x):x=v[23],v[24]!==x||v[25]!==u?(y=(0,r.jsxs)(m.motion.div,{initial:t,animate:l,transition:i,className:"flex min-h-[800px] w-[800px] flex-col rounded-[40px] border bg-white/60 p-6 shadow",children:[u,x]}),v[24]=x,v[25]=u,v[26]=y):y=v[26],y}function x(e){let t,l,i,s,o,c,u,f,h,p,x,b=(0,a.c)(25),{delay:w}=e,N=void 0===w?0:w,{images:I,setCover:_,cover:j,addFiles:O}=d(),T=(0,g.useRef)(null),E=j?"url"===j.type?j.url:j.previewUrl:null;b[0]!==O||b[1]!==I||b[2]!==_?(t=async e=>{e.preventDefault();let t=e.dataTransfer.getData("text/markdown")||e.dataTransfer.getData("text/plain")||"",l=/!\[\]\(([^)]+)\)/.exec(t.trim());if(l){let e,t=l[1];if(t.startsWith("local-image:")){let l=t.replace(/^local-image:/,"");e=I.find(e=>e.id===l)}else e=I.find(e=>"url"===e.type&&e.url===t);if(e){_(e),n.toast.success("已设置封面");return}}let r=e.dataTransfer.files;if(r&&r.length>0){let e=Array.from(r).filter(v);if(0===e.length)return void n.toast.error("请拖入图片文件");let t=I.length;await O(e);let l=d.getState().images;return void(l.length>t&&(_(l[0]),n.toast.success("已设置封面")))}},b[0]=O,b[1]=I,b[2]=_,b[3]=t):t=b[3];let C=t;b[4]===Symbol.for("react.memo_cache_sentinel")?(l=()=>{T.current?.click()},b[4]=l):l=b[4];let S=l;b[5]!==O||b[6]!==I||b[7]!==_?(i=async e=>{let t=e.target.files;if(!t||0===t.length)return;let l=I.length;await O(t);let r=d.getState().images;r.length>l&&(_(r[0]),n.toast.success("已设置封面")),e.target.value=""},b[5]=O,b[6]=I,b[7]=_,b[8]=i):i=b[8];let G=i;return b[9]===Symbol.for("react.memo_cache_sentinel")?(s={opacity:0,scale:.8},o={opacity:1,scale:1},b[9]=s,b[10]=o):(s=b[9],o=b[10]),b[11]!==N?(c={delay:N},b[11]=N,b[12]=c):c=b[12],b[13]===Symbol.for("react.memo_cache_sentinel")?(u=(0,r.jsx)("h2",{className:"text-sm",children:"封面"}),b[13]=u):u=b[13],b[14]!==G?(f=(0,r.jsx)("input",{ref:T,type:"file",accept:"image/*",className:"hidden",onChange:G}),b[14]=G,b[15]=f):f=b[15],b[16]!==E?(h=E?(0,r.jsx)("img",{src:E,alt:"cover preview",className:"h-full w-full rounded-2xl object-cover"}):(0,r.jsx)("div",{className:"grid h-full w-full cursor-pointer place-items-center transition-colors hover:bg-white/60",onClick:S,children:(0,r.jsx)("span",{className:"text-3xl leading-none text-neutral-400",children:"+"})}),b[16]=E,b[17]=h):h=b[17],b[18]!==C||b[19]!==h?(p=(0,r.jsx)("div",{className:"mt-3 h-[150px] overflow-hidden rounded-xl border bg-white/60",onDragOver:y,onDrop:C,children:h}),b[18]=C,b[19]=h,b[20]=p):p=b[20],b[21]!==p||b[22]!==c||b[23]!==f?(x=(0,r.jsxs)(m.motion.div,{initial:s,animate:o,transition:c,className:"card relative",children:[u,f,p]}),b[21]=p,b[22]=c,b[23]=f,b[24]=x):x=b[24],x}function y(e){e.preventDefault()}function v(e){return e.type.startsWith("image/")}function b(e){let t,l,i,n,s,o,c,d=(0,a.c)(19),{tags:u,onChange:m}=e,[f,h]=(0,g.useState)("");d[0]!==m||d[1]!==f||d[2]!==u?(t=()=>{f.trim()&&!u.includes(f.trim())&&(m([...u,f.trim()]),h(""))},d[0]=m,d[1]=f,d[2]=u,d[3]=t):t=d[3];let p=t;d[4]!==m||d[5]!==u?(l=e=>{m(u.filter((t,l)=>l!==e))},d[4]=m,d[5]=u,d[6]=l):l=d[6];let x=l;return d[7]!==x||d[8]!==u?(i=u.length>0&&(0,r.jsx)("div",{className:"mb-2 flex flex-wrap gap-2",children:u.map((e,t)=>(0,r.jsxs)("span",{className:"flex items-center gap-1.5 rounded-md bg-blue-100 px-2 py-1 text-sm text-blue-700",children:["#",e,(0,r.jsx)("button",{type:"button",onClick:()=>x(t),className:"text-secondary",children:"×"})]},t))}),d[7]=x,d[8]=u,d[9]=i):i=d[9],d[10]===Symbol.for("react.memo_cache_sentinel")?(n=e=>h(e.target.value),d[10]=n):n=d[10],d[11]!==p?(s=e=>{"Enter"===e.key&&(e.preventDefault(),p())},d[11]=p,d[12]=s):s=d[12],d[13]!==s||d[14]!==f?(o=(0,r.jsx)("input",{type:"text",placeholder:"添加标签（按回车）",className:"w-full bg-transparent text-sm outline-none",value:f,onChange:n,onKeyDown:s}),d[13]=s,d[14]=f,d[15]=o):o=d[15],d[16]!==i||d[17]!==o?(c=(0,r.jsxs)("div",{className:"w-full rounded-lg border bg-white/70 px-3 py-2",children:[i,o]}),d[16]=i,d[17]=o,d[18]=c):c=d[18],c}function w(e){let t,l,i,n,s,o,c,u,f,g,h,p,x=(0,a.c)(27),{delay:y}=e,v=void 0===y?0:y,{form:w,updateForm:N}=d();return x[0]===Symbol.for("react.memo_cache_sentinel")?(t={opacity:0,scale:.8},l={opacity:1,scale:1},x[0]=t,x[1]=l):(t=x[0],l=x[1]),x[2]!==v?(i={delay:v},x[2]=v,x[3]=i):i=x[3],x[4]===Symbol.for("react.memo_cache_sentinel")?(n=(0,r.jsx)("h2",{className:"text-sm",children:"元信息"}),x[4]=n):n=x[4],x[5]!==N?(s=e=>N({summary:e.target.value}),x[5]=N,x[6]=s):s=x[6],x[7]!==w.summary||x[8]!==s?(o=(0,r.jsx)("textarea",{placeholder:"为这篇文章写一段简短摘要",rows:2,className:"block w-full resize-none rounded-xl border bg-white/60 p-3 text-sm",value:w.summary,onChange:s}),x[7]=w.summary,x[8]=s,x[9]=o):o=x[9],x[10]!==N?(c=e=>N({tags:e}),x[10]=N,x[11]=c):c=x[11],x[12]!==w.tags||x[13]!==c?(u=(0,r.jsx)(b,{tags:w.tags,onChange:c}),x[12]=w.tags,x[13]=c,x[14]=u):u=x[14],x[15]!==N?(f=e=>N({date:e.target.value}),x[15]=N,x[16]=f):f=x[16],x[17]!==w.date||x[18]!==f?(g=(0,r.jsx)("input",{type:"date",placeholder:"日期",className:"w-full rounded-lg border bg-white/60 px-3 py-2 text-sm",value:w.date,onChange:f}),x[17]=w.date,x[18]=f,x[19]=g):g=x[19],x[20]!==g||x[21]!==o||x[22]!==u?(h=(0,r.jsxs)("div",{className:"mt-3 space-y-2",children:[o,u,g]}),x[20]=g,x[21]=o,x[22]=u,x[23]=h):h=x[23],x[24]!==h||x[25]!==i?(p=(0,r.jsxs)(m.motion.div,{initial:t,animate:l,transition:i,className:"card relative",children:[n,h]}),x[24]=h,x[25]=i,x[26]=p):p=x[26],p}var N=e.i(22016);function I(e){let t,l,i,n,s,o,c,u,f,h,p,x,y,v,b,w,I=(0,a.c)(37),{delay:j}=e,O=void 0===j?0:j,{images:T,cover:E,addUrlImage:C,addFiles:S,deleteImage:G}=d(),[R,B]=(0,g.useState)(""),U=(0,g.useRef)(null),H=E?.id??null;if(I[0]===Symbol.for("react.memo_cache_sentinel")?(t={opacity:0,scale:.8},l={opacity:1,scale:1},I[0]=t,I[1]=l):(t=I[0],l=I[1]),I[2]!==O?(i={delay:O},I[2]=O,I[3]=i):i=I[3],I[4]===Symbol.for("react.memo_cache_sentinel")?(n=(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-sm",children:"图片管理"}),(0,r.jsx)(N.default,{href:"/image-toolbox",target:"_blank",className:"text-xs hover:underline",children:"压缩工具"})]}),I[4]=n):n=I[4],I[5]===Symbol.for("react.memo_cache_sentinel")?(s=e=>B(e.target.value),I[5]=s):s=I[5],I[6]!==R?(o=(0,r.jsx)("input",{type:"text",placeholder:"https://...",className:"flex-1 rounded-lg border bg-white/70 px-3 py-2 text-sm",value:R,onChange:s}),I[6]=R,I[7]=o):o=I[7],I[8]!==C||I[9]!==R?(c=(0,r.jsx)("button",{className:"rounded-lg border bg-white/70 px-3 py-2 text-sm",onClick:()=>{let e=R.trim();e&&(C(e),B(""))},children:"添加"}),I[8]=C,I[9]=R,I[10]=c):c=I[10],I[11]!==o||I[12]!==c?(u=(0,r.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[o,c]}),I[11]=o,I[12]=c,I[13]=u):u=I[13],I[14]!==S?(f=(0,r.jsx)("input",{ref:U,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:e=>{let t=e.target.files;t&&t.length>0&&S(t),e.currentTarget&&(e.currentTarget.value="")}}),I[14]=S,I[15]=f):f=I[15],I[16]===Symbol.for("react.memo_cache_sentinel")?(h=()=>U.current?.click(),I[16]=h):h=I[16],I[17]!==S?(p=e=>{e.preventDefault();let t=e.dataTransfer.files;t&&t.length&&S(t)},I[17]=S,I[18]=p):p=I[18],I[19]===Symbol.for("react.memo_cache_sentinel")?(x=(0,r.jsx)("span",{className:"text-2xl leading-none text-neutral-400",children:"+"}),I[19]=x):x=I[19],I[20]!==p?(y=(0,r.jsx)("div",{className:"group relative grid aspect-square cursor-pointer place-items-center rounded-lg border bg-white/50 hover:bg-white/70",onClick:h,onDragOver:_,onDrop:p,children:x}),I[20]=p,I[21]=y):y=I[21],I[22]!==H||I[23]!==G||I[24]!==T){let e;I[26]!==H||I[27]!==G?(e=e=>{let t="url"===e.type,l=t?e.url:e.previewUrl,a=t?`![](${e.url})`:`![](local-image:${e.id})`,i=H===e.id;return(0,r.jsxs)("div",{className:`group relative aspect-square overflow-hidden rounded-lg border bg-white/50 text-xs ${i?"ring-2 ring-blue-500":""}`,children:[(0,r.jsx)("img",{src:l,className:"h-full w-full object-cover",draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/plain",a),e.dataTransfer.setData("text/markdown",a)}}),i&&(0,r.jsx)("div",{className:"absolute top-1 left-1 rounded-md bg-blue-500 px-1.5 py-0.5 text-white shadow",children:"封面"}),(0,r.jsx)("div",{className:"absolute top-1 right-1 hidden group-hover:flex",children:(0,r.jsx)("button",{type:"button",className:"rounded-md bg-white/80 px-1.5 py-0.5 shadow hover:bg-white",onClick:()=>G(e.id),children:"删除"})})]},e.id)},I[26]=H,I[27]=G,I[28]=e):e=I[28],v=T.map(e),I[22]=H,I[23]=G,I[24]=T,I[25]=v}else v=I[25];return I[29]!==y||I[30]!==v?(b=(0,r.jsxs)("div",{className:"mt-3 grid grid-cols-4 gap-2",children:[y,v]}),I[29]=y,I[30]=v,I[31]=b):b=I[31],I[32]!==f||I[33]!==b||I[34]!==i||I[35]!==u?(w=(0,r.jsxs)(m.motion.div,{initial:t,animate:l,transition:i,className:"card relative",children:[n,u,f,b]}),I[32]=f,I[33]=b,I[34]=i,I[35]=u,I[36]=w):w=I[36],w}function _(e){e.preventDefault()}function j(){let e,t=(0,a.c)(1);return t[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,r.jsxs)("div",{className:"w-[320px] space-y-6",children:[(0,r.jsx)(x,{delay:f.INIT_DELAY+0*f.ANIMATION_DELAY}),(0,r.jsx)(w,{delay:f.INIT_DELAY+ +f.ANIMATION_DELAY}),(0,r.jsx)(I,{delay:f.INIT_DELAY+2*f.ANIMATION_DELAY})]}),t[0]=e):e=t[0],e}var O=e.i(37572),T=e.i(43026),E=e.i(86909),C=e.i(75157);async function S(e){let t,{form:l,cover:r,images:a,mode:i="create",originalSlug:o}=e;if(!l?.slug)throw Error("需要 slug");if("edit"===i&&o&&o!==l.slug)throw Error("编辑模式下不支持修改 slug，请保持原 slug 不变");let c=await (0,E.getAuthToken)();n.toast.info("正在获取分支信息...");let d=(await (0,O.getRef)(c,f.GITHUB_CONFIG.OWNER,f.GITHUB_CONFIG.REPO,`heads/${f.GITHUB_CONFIG.BRANCH}`)).sha,u=`public/blogs/${l.slug}`,m="edit"===i?`更新文章: ${l.slug}`:`新增文章: ${l.slug}`,g=[];for(let e of a||[])"file"===e.type&&g.push({img:e,id:e.id});r?.type==="file"&&g.push({img:r,id:r.id}),n.toast.info("正在准备文件...");let h=new Set,p=l.md,x=[];if(g.length>0)for(let{img:e,id:a}of(n.toast.info("正在上传图片..."),g)){let i=e.hash||await (0,s.hashFileSHA256)(e.file),n=(0,C.getFileExt)(e.file.name),o=`${i}${n}`,d=`/blogs/${l.slug}/${o}`;if(!h.has(i)){let t=`${u}/${o}`,l=await (0,s.fileToBase64NoPrefix)(e.file),r=await (0,O.createBlob)(c,f.GITHUB_CONFIG.OWNER,f.GITHUB_CONFIG.REPO,l,"base64");x.push({path:t,mode:"100644",type:"blob",sha:r.sha}),h.add(i)}let m=`local-image:${a}`;p=p.split(`(${m})`).join(`(${d})`),r?.type==="file"&&r.id===a&&(t=d)}r?.type==="url"&&(t=r.url),n.toast.info("正在创建文件...");let y=await (0,O.createBlob)(c,f.GITHUB_CONFIG.OWNER,f.GITHUB_CONFIG.REPO,(0,O.toBase64Utf8)(p),"base64");x.push({path:`${u}/index.md`,mode:"100644",type:"blob",sha:y.sha});let v=l.date||new Date().toISOString().slice(0,10),b={title:l.title,tags:l.tags,date:v,summary:l.summary,cover:t},w=await (0,O.createBlob)(c,f.GITHUB_CONFIG.OWNER,f.GITHUB_CONFIG.REPO,(0,O.toBase64Utf8)(JSON.stringify(b,null,2)),"base64");x.push({path:`${u}/config.json`,mode:"100644",type:"blob",sha:w.sha});let N=await (0,T.prepareBlogsIndex)(c,f.GITHUB_CONFIG.OWNER,f.GITHUB_CONFIG.REPO,{slug:l.slug,title:l.title,tags:l.tags,date:v,summary:l.summary,cover:t},f.GITHUB_CONFIG.BRANCH),I=await (0,O.createBlob)(c,f.GITHUB_CONFIG.OWNER,f.GITHUB_CONFIG.REPO,(0,O.toBase64Utf8)(N),"base64");x.push({path:"public/blogs/index.json",mode:"100644",type:"blob",sha:I.sha}),n.toast.info("正在创建文件树...");let _=await (0,O.createTree)(c,f.GITHUB_CONFIG.OWNER,f.GITHUB_CONFIG.REPO,x,d);n.toast.info("正在创建提交...");let j=await (0,O.createCommit)(c,f.GITHUB_CONFIG.OWNER,f.GITHUB_CONFIG.REPO,m,_.sha,[d]);n.toast.info("正在更新分支..."),await (0,O.updateRef)(c,f.GITHUB_CONFIG.OWNER,f.GITHUB_CONFIG.REPO,`heads/${f.GITHUB_CONFIG.BRANCH}`,j.sha),n.toast.success("发布成功！")}async function G(e){if(!e)throw Error("需要 slug");let t=await (0,E.getAuthToken)();n.toast.info("正在获取分支信息...");let l=(await (0,O.getRef)(t,f.GITHUB_CONFIG.OWNER,f.GITHUB_CONFIG.REPO,`heads/${f.GITHUB_CONFIG.BRANCH}`)).sha,r=`public/blogs/${e}`;n.toast.info("正在收集文章文件...");let a=await (0,O.listRepoFilesRecursive)(t,f.GITHUB_CONFIG.OWNER,f.GITHUB_CONFIG.REPO,r,f.GITHUB_CONFIG.BRANCH);if(0===a.length)throw Error("文章不存在或已删除");let i=a.map(e=>({path:e,mode:"100644",type:"blob",sha:null}));n.toast.info("正在更新索引...");let s=await (0,T.removeBlogFromIndex)(t,f.GITHUB_CONFIG.OWNER,f.GITHUB_CONFIG.REPO,e,f.GITHUB_CONFIG.BRANCH),o=await (0,O.createBlob)(t,f.GITHUB_CONFIG.OWNER,f.GITHUB_CONFIG.REPO,(0,O.toBase64Utf8)(s),"base64");i.push({path:"public/blogs/index.json",mode:"100644",type:"blob",sha:o.sha}),n.toast.info("正在创建提交...");let c=await (0,O.createTree)(t,f.GITHUB_CONFIG.OWNER,f.GITHUB_CONFIG.REPO,i,l),d=await (0,O.createCommit)(t,f.GITHUB_CONFIG.OWNER,f.GITHUB_CONFIG.REPO,`删除文章: ${e}`,c.sha,[l]);n.toast.info("正在更新分支..."),await (0,O.updateRef)(t,f.GITHUB_CONFIG.OWNER,f.GITHUB_CONFIG.REPO,`heads/${f.GITHUB_CONFIG.BRANCH}`,d.sha),n.toast.success("删除成功！请等待页面部署后刷新")}var R=e.i(71436);function B(){let e,t,l,i,o,c,f,h,p,x,y,v,b,w,N,I,_=(0,a.c)(35),{loading:j,mode:O,form:T}=d(),{openPreview:E}=u(),{isAuth:C,onChoosePrivateKey:B,onPublish:U,onDelete:H}=function(){let{loading:e,setLoading:t,form:l,cover:r,images:a,mode:i,originalSlug:o}=d(),{isAuth:c,setPrivateKey:u}=(0,R.useAuthStore)(),m=(0,g.useCallback)(async e=>{u(await (0,s.readFileAsText)(e))},[u]),f=(0,g.useCallback)(async()=>{try{t(!0),await S({form:l,cover:r,images:a,mode:i,originalSlug:o});let e="edit"===i?"更新成功":"发布成功";n.toast.success(e)}catch(e){console.error(e),n.toast.error(e?.message||"操作失败")}finally{t(!1)}},[l,r,a,i,o,t]);return{isAuth:c,loading:e,onChoosePrivateKey:m,onPublish:f,onDelete:(0,g.useCallback)(async()=>{let e=o||l.slug;if(!e)return void n.toast.error("缺少 slug，无法删除");try{t(!0),await G(e)}catch(e){console.error(e),n.toast.error(e?.message||"删除失败")}finally{t(!1)}},[l.slug,o,t])}}(),A=(0,g.useRef)(null);_[0]!==C||_[1]!==U?(e=()=>{C?U():A.current?.click()},_[0]=C,_[1]=U,_[2]=e):e=_[2];let F=e,k=C?"edit"===O?"更新":"发布":"导入密钥";_[3]!==T||_[4]!==C||_[5]!==H?(t=()=>{if(!C)return void n.toast.info("请先导入密钥");let e=T?.title?`确定删除《${T.title}》吗？该操作不可恢复。`:"确定删除当前文章吗？该操作不可恢复。";window.confirm(e)&&H()},_[3]=T,_[4]=C,_[5]=H,_[6]=t):t=_[6];let L=t;return _[7]!==B?(l=(0,r.jsx)("input",{ref:A,type:"file",accept:".pem",className:"hidden",onChange:async e=>{let t=e.target.files?.[0];t&&await B(t),e.currentTarget&&(e.currentTarget.value="")}}),_[7]=B,_[8]=l):l=_[8],_[9]!==L||_[10]!==j||_[11]!==O?(i="edit"===O&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.motion.div,{initial:{opacity:0,scale:.6},animate:{opacity:1,scale:1},className:"flex items-center gap-2",children:(0,r.jsx)("div",{className:"rounded-lg border bg-blue-50 px-4 py-2 text-sm text-blue-700",children:"编辑模式"})}),(0,r.jsx)(m.motion.button,{initial:{opacity:0,scale:.6},animate:{opacity:1,scale:1},whileHover:{scale:1.05},whileTap:{scale:.95},className:"rounded-xl border border-red-200 bg-red-50 px-4 py-2 text-sm text-red-600 transition-colors hover:bg-red-100",disabled:j,onClick:L,children:"删除"})]}),_[9]=L,_[10]=j,_[11]=O,_[12]=i):i=_[12],_[13]===Symbol.for("react.memo_cache_sentinel")?(o={opacity:0,scale:.6},c={opacity:1,scale:1},f={scale:1.05},h={scale:.95},_[13]=o,_[14]=c,_[15]=f,_[16]=h):(o=_[13],c=_[14],f=_[15],h=_[16]),_[17]!==j||_[18]!==E?(p=(0,r.jsx)(m.motion.button,{initial:o,animate:c,whileHover:f,whileTap:h,className:"rounded-xl border bg-white/60 px-6 py-2 text-sm",disabled:j,onClick:E,children:"预览"}),_[17]=j,_[18]=E,_[19]=p):p=_[19],_[20]===Symbol.for("react.memo_cache_sentinel")?(b={opacity:0,scale:.6},x={opacity:1,scale:1},y={scale:1.05},v={scale:.95},_[20]=x,_[21]=y,_[22]=v,_[23]=b):(x=_[20],y=_[21],v=_[22],b=_[23]),_[24]!==k||_[25]!==F||_[26]!==j?(w=(0,r.jsx)(m.motion.button,{initial:b,animate:x,whileHover:y,whileTap:v,className:"brand-btn px-6",disabled:j,onClick:F,children:k}),_[24]=k,_[25]=F,_[26]=j,_[27]=w):w=_[27],_[28]!==w||_[29]!==i||_[30]!==p?(N=(0,r.jsxs)("ul",{className:"absolute top-4 right-6 flex items-center gap-2",children:[i,p,w]}),_[28]=w,_[29]=i,_[30]=p,_[31]=N):N=_[31],_[32]!==N||_[33]!==l?(I=(0,r.jsxs)(r.Fragment,{children:[l,N]}),_[32]=N,_[33]=l,_[34]=I):I=_[34],I}var U=e.i(72910),H=e.i(99151),A=e.i(86427),F=e.i(65566),k=e.i(60830),L=e.i(87022);function D(e,t){let l,r=()=>{let{currentTime:r}=t,a=(null===r?0:r.value)/100;l!==a&&e(a),l=a};return L.frame.preUpdate(r,!0),()=>(0,L.cancelFrame)(r)}var W=e.i(30551),P=e.i(89026),$=e.i(49652);let M=new WeakMap,Y=(e,t,l)=>(r,a)=>a&&a[0]?a[0][e+"Size"]:(0,P.isSVGElement)(r)&&"getBBox"in r?r.getBBox()[t]:r[l],z=Y("inline","width","offsetWidth"),V=Y("block","height","offsetHeight");function K({target:e,borderBoxSize:t}){M.get(e)?.forEach(l=>{l(e,{get width(){return z(e,t)},get height(){return V(e,t)}})})}function J(e){e.forEach(K)}let X=new Set;var q=e.i(83920),Q=e.i(25791);let Z=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),ee={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function et(e,t,l,r){let a=l[t],{length:i,position:n}=ee[t],s=a.current,o=l.time;a.current=e[`scroll${n}`],a.scrollLength=e[`scroll${i}`]-e[`client${i}`],a.offset.length=0,a.offset[0]=0,a.offset[1]=a.scrollLength,a.progress=(0,q.progress)(0,a.scrollLength,a.current);let c=r-o;a.velocity=c>50?0:(0,Q.velocityPerSecond)(a.current-s,c)}e.i(47167);var el=e.i(44230),er=e.i(15923),ea=e.i(76959),ei=e.i(72846);let en={start:0,center:.5,end:1};function es(e,t,l=0){let r=0;if(e in en&&(e=en[e]),"string"==typeof e){let t=parseFloat(e);e.endsWith("px")?r=t:e.endsWith("%")?e=t/100:e.endsWith("vw")?r=t/100*document.documentElement.clientWidth:e.endsWith("vh")?r=t/100*document.documentElement.clientHeight:e=t}return"number"==typeof e&&(r=t*e),l+r}let eo=[0,0],ec=[[0,0],[1,1]],ed={x:0,y:0},eu=new WeakMap,em=new WeakMap,ef=new WeakMap,eg=e=>e===document.scrollingElement?window:e;function eh(e,{container:r=document.scrollingElement,...a}={}){if(!r)return k.noop;let i=ef.get(r);i||(i=new Set,ef.set(r,i));let n=function(e,t,l,r={}){return{measure:t=>{!function(e,t=e,l){if(l.x.targetOffset=0,l.y.targetOffset=0,t!==e){let r=t;for(;r&&r!==e;)l.x.targetOffset+=r.offsetLeft,l.y.targetOffset+=r.offsetTop,r=r.offsetParent}l.x.targetLength=t===e?t.scrollWidth:t.clientWidth,l.y.targetLength=t===e?t.scrollHeight:t.clientHeight,l.x.containerLength=e.clientWidth,l.y.containerLength=e.clientHeight}(e,r.target,l),et(e,"x",l,t),et(e,"y",l,t),l.time=t,(r.offset||r.target)&&function(e,t,l){let{offset:r=ec}=l,{target:a=e,axis:i="y"}=l,n="y"===i?"height":"width",s=a!==e?function(e,t){let l={x:0,y:0},r=e;for(;r&&r!==t;)if((0,ei.isHTMLElement)(r))l.x+=r.offsetLeft,l.y+=r.offsetTop,r=r.offsetParent;else if("svg"===r.tagName){let e=r.getBoundingClientRect(),t=(r=r.parentElement).getBoundingClientRect();l.x+=e.left-t.left,l.y+=e.top-t.top}else if(r instanceof SVGGraphicsElement){let{x:e,y:t}=r.getBBox();l.x+=e,l.y+=t;let a=null,i=r.parentNode;for(;!a;)"svg"===i.tagName&&(a=i),i=r.parentNode;r=a}else break;return l}(a,e):ed,o=a===e?{width:e.scrollWidth,height:e.scrollHeight}:"getBBox"in a&&"svg"!==a.tagName?a.getBBox():{width:a.clientWidth,height:a.clientHeight},c={width:e.clientWidth,height:e.clientHeight};t[i].offset.length=0;let d=!t[i].interpolate,u=r.length;for(let e=0;e<u;e++){let l=function(e,t,l,r){let a=Array.isArray(e)?e:eo,i=0;return"number"==typeof e?a=[e,e]:"string"==typeof e&&(a=(e=e.trim()).includes(" ")?e.split(" "):[e,en[e]?e:"0"]),(i=es(a[0],l,r))-es(a[1],t)}(r[e],c[n],o[n],s[i]);d||l===t[i].interpolatorOffsets[e]||(d=!0),t[i].offset[e]=l}d&&(t[i].interpolate=(0,el.interpolate)(t[i].offset,(0,er.defaultOffset)(r),{clamp:!1}),t[i].interpolatorOffsets=[...t[i].offset]),t[i].progress=(0,ea.clamp)(0,1,t[i].interpolate(t[i].current))}(e,l,r)},notify:()=>t(l)}}(r,e,{time:0,x:Z(),y:Z()},a);if(i.add(n),!eu.has(r)){let e,a=()=>{for(let e of i)e.measure(L.frameData.timestamp);L.frame.preUpdate(n)},n=()=>{for(let e of i)e.notify()},s=()=>L.frame.read(a);eu.set(r,s);let o=eg(r);window.addEventListener("resize",s,{passive:!0}),r!==document.documentElement&&em.set(r,"function"==typeof r?(X.add(r),l||(l=()=>{let e={get width(){return window.innerWidth},get height(){return window.innerHeight}};X.forEach(t=>t(e))},window.addEventListener("resize",l)),()=>{X.delete(r),X.size||"function"!=typeof l||(window.removeEventListener("resize",l),l=void 0)}):(t||"undefined"!=typeof ResizeObserver&&(t=new ResizeObserver(J)),(e=(0,$.resolveElements)(r)).forEach(e=>{let l=M.get(e);l||(l=new Set,M.set(e,l)),l.add(s),t?.observe(e)}),()=>{e.forEach(e=>{let l=M.get(e);l?.delete(s),l?.size||t?.unobserve(e)})})),o.addEventListener("scroll",s,{passive:!0}),s()}let s=eu.get(r);return L.frame.read(s,!1,!0),()=>{(0,L.cancelFrame)(s);let e=ef.get(r);if(!e||(e.delete(n),e.size))return;let t=eu.get(r);eu.delete(r),t&&(eg(r).removeEventListener("scroll",t),em.get(r)?.(),window.removeEventListener("resize",t))}}let ep=new Map;function ex({source:e,container:t,...l}){var r;let a,i,{axis:n}=l;e&&(t=e);let s=ep.get(t)??new Map;ep.set(t,s);let o=l.target??"self",c=s.get(o)??{},d=n+(l.offset??[]).join(",");return c[d]||(c[d]=!l.target&&(0,W.supportsScrollTimeline)()?new ScrollTimeline({source:t,axis:n}):(r={container:t,...l},a={value:0},i=eh(e=>{a.value=100*e[r.axis].progress},r),{currentTime:a,cancel:i})),c[d]}var ey=e.i(47414),ev=e.i(74008);let eb=()=>({scrollX:(0,A.motionValue)(0),scrollY:(0,A.motionValue)(0),scrollXProgress:(0,A.motionValue)(0),scrollYProgress:(0,A.motionValue)(0)}),ew=e=>!!e&&!e.current;var eN=e.i(83352),eI=e.i(83411);function e_(e){return"number"==typeof e?e:parseFloat(e)}var ej=e.i(37806);function eO(e){let t=(0,ey.useConstant)(()=>(0,A.motionValue)(e)),{isStatic:l}=(0,g.useContext)(ej.MotionConfigContext);if(l){let[,l]=(0,g.useState)(e);(0,g.useEffect)(()=>t.on("change",l),[])}return t}function eT(e,t){let l=eO(t()),r=()=>l.set(t());return r(),(0,ev.useIsomorphicLayoutEffect)(()=>{let t=()=>L.frame.preRender(r,!1,!0),l=e.map(e=>e.on("change",t));return()=>{l.forEach(e=>e()),(0,L.cancelFrame)(r)}}),l}function eE(e,t,l,r){if("function"==typeof e){let t;return A.collectMotionValues.current=[],e(),t=eT(A.collectMotionValues.current,e),A.collectMotionValues.current=void 0,t}let a="function"==typeof t?t:function(...e){let t=!Array.isArray(e[0]),l=t?0:-1,r=e[0+l],a=e[1+l],i=e[2+l],n=e[3+l],s=(0,el.interpolate)(a,i,n);return t?s(r):s}(t,l,r);return Array.isArray(e)?eC(e,a):eC([e],([e])=>a(e))}function eC(e,t){let l=(0,ey.useConstant)(()=>[]);return eT(e,()=>{l.length=0;let r=e.length;for(let t=0;t<r;t++)l[t]=e[t].get();return t(l)})}var eS=e.i(99533),eG=e.i(7670);function eR(e){let t,l,i,n,s,o,c,d,u,f,h,p,x=(0,a.c)(27),{toc:y,delay:v}=e,b=void 0===v?0:v;x[0]===Symbol.for("react.memo_cache_sentinel")?(t=new Set,x[0]=t):t=x[0];let[w,N]=(0,g.useState)(t);if(x[1]!==w||x[2]!==y){let e;x[4]!==y?(e=(e,t)=>y.findIndex(t=>t.id===e)-y.findIndex(e=>e.id===t),x[4]=y,x[5]=e):e=x[5],l=Array.from(w).sort(e),x[1]=w,x[2]=y,x[3]=l}else l=x[3];let I=l[0];if(x[6]!==y?(i=()=>{if(0===y.length)return;let e=new Map;return y.forEach(t=>{let l=document.getElementById(t.id);if(!l)return;let r=new IntersectionObserver(e=>{e.forEach(e=>{N(t=>{let l=new Set(t);return e.isIntersecting?l.add(e.target.id):l.delete(e.target.id),l})})},{rootMargin:"-100px 0px -100px 0px",threshold:0});r.observe(l),e.set(t.id,r)}),()=>{e.forEach(eB)}},n=[y],x[6]=y,x[7]=i,x[8]=n):(i=x[7],n=x[8]),(0,g.useEffect)(i,n),x[9]===Symbol.for("react.memo_cache_sentinel")?(s={opacity:0,scale:.8},o={opacity:1,scale:1},x[9]=s,x[10]=o):(s=x[9],o=x[10]),x[11]!==b?(c={delay:b},x[11]=b,x[12]=c):c=x[12],x[13]===Symbol.for("react.memo_cache_sentinel")?(d=(0,r.jsx)("h2",{className:"text-secondary mb-2 font-medium",children:"目录"}),x[13]=d):d=x[13],x[14]!==y.length?(u=0===y.length&&(0,r.jsx)("div",{className:"text-secondary",children:"暂无"}),x[14]=y.length,x[15]=u):u=x[15],x[16]!==I||x[17]!==y){let e;x[19]!==I?(e=e=>(0,r.jsx)("a",{href:`#${e.id}`,className:(0,eG.default)("hover:text-brand relative block pl-3 transition-colors",e.id===I&&"text-brand"),style:{paddingLeft:(e.level-1)*8},children:e.text},e.id+e.level),x[19]=I,x[20]=e):e=x[20],f=y.map(e),x[16]=I,x[17]=y,x[18]=f}else f=x[18];return x[21]!==u||x[22]!==f?(h=(0,r.jsxs)("div",{className:"relative space-y-2",children:[u,f]}),x[21]=u,x[22]=f,x[23]=h):h=x[23],x[24]!==h||x[25]!==c?(p=(0,r.jsxs)(m.motion.div,{initial:s,animate:o,transition:c,className:"w-full rounded-xl border bg-white/40 p-3 text-sm",children:[d,h]}),x[24]=h,x[25]=c,x[26]=p):p=x[26],p}function eB(e){return e.disconnect()}var eU=e.i(53657);function eH(e){let t,l,i,n,s,o,c,d,u,f,h,p,x=(0,a.c)(15),{className:y,delay:v}=e,[b,w]=(0,g.useState)(!1),[N,I]=(0,g.useState)(!1);if(x[0]!==v?(t=()=>{setTimeout(()=>w(!0),v||1e3)},l=[v],x[0]=v,x[1]=t,x[2]=l):(t=x[1],l=x[2]),(0,g.useEffect)(t,l),x[3]===Symbol.for("react.memo_cache_sentinel")?(i=()=>{let e=()=>{I(window.scrollY>100)};return e(),window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)},n=[],x[3]=i,x[4]=n):(i=x[3],n=x[4]),(0,g.useEffect)(i,n),!b||!N)return null;x[5]===Symbol.for("react.memo_cache_sentinel")?(s=()=>{window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>I(!1),1e3)},x[5]=s):s=x[5];let _=s;return x[6]===Symbol.for("react.memo_cache_sentinel")?(o={opacity:0,scale:.4},c={opacity:1,scale:1},d={scale:1.05},u={scale:.95},x[6]=o,x[7]=c,x[8]=d,x[9]=u):(o=x[6],c=x[7],d=x[8],u=x[9]),x[10]!==y?(f=(0,eG.default)("card text-secondary static gap-2 rounded-full p-3 text-sm",y),x[10]=y,x[11]=f):f=x[11],x[12]===Symbol.for("react.memo_cache_sentinel")?(h=(0,r.jsx)(eU.default,{className:"w-7"}),x[12]=h):h=x[12],x[13]!==f?(p=(0,r.jsx)(m.motion.button,{initial:o,animate:c,whileHover:d,whileTap:u,onClick:_,"aria-label":"Scroll to top",className:f,children:h}),x[13]=f,x[14]=p):p=x[14],p}function eA(e){let t,l,i,n,s,o,c,d,u=(0,a.c)(18),{cover:h,summary:p,toc:x,slug:y}=e,{scrollY:v}=function({container:e,target:t,...l}={}){let r=(0,ey.useConstant)(eb),a=(0,g.useRef)(null),i=(0,g.useRef)(!1),n=(0,g.useCallback)(()=>(a.current=function(e,{axis:t="y",container:l=document.scrollingElement,...r}={}){var a,i;let n;if(!l)return k.noop;let s={axis:t,container:l,...r};return"function"==typeof e?(a=e,i=s,2===a.length?eh(e=>{a(e[i.axis].progress,e)},i):D(a,ex(i))):(n=ex(s),e.attachTimeline({timeline:s.target?void 0:n,observe:e=>(e.pause(),D(t=>{e.time=e.iterationDuration*t},n))}))}((e,{x:t,y:l})=>{r.scrollX.set(t.current),r.scrollXProgress.set(t.progress),r.scrollY.set(l.current),r.scrollYProgress.set(l.progress)},{...l,container:e?.current||void 0,target:t?.current||void 0}),()=>{a.current?.()}),[e,t,JSON.stringify(l.offset)]);return(0,ev.useIsomorphicLayoutEffect)(()=>{if(i.current=!1,!(ew(e)||ew(t)))return n();i.current=!0},[n]),(0,g.useEffect)(()=>i.current?((0,F.invariant)(!ew(e),"Container ref is defined but not hydrated","use-scroll-ref"),(0,F.invariant)(!ew(t),"Target ref is defined but not hydrated","use-scroll-ref"),n()):void 0,[n]),r}(),b=eE(v,eF);u[0]===Symbol.for("react.memo_cache_sentinel")?(t={stiffness:100,damping:15,mass:.6,restDelta:.5},u[0]=t):t=u[0];let w=function(e,t={}){let{isStatic:l}=(0,g.useContext)(ej.MotionConfigContext),r=()=>(0,eI.isMotionValue)(e)?e.get():e;if(l)return eE(r);let a=eO(r());return(0,g.useInsertionEffect)(()=>(function(e,t,l){let r,a=e.get(),i=null,n=a,s="string"==typeof a?a.replace(/[\d.-]/g,""):void 0,o=()=>{i&&(i.stop(),i=null)},c=()=>{o(),i=new eN.JSAnimation({keyframes:[e_(e.get()),e_(n)],velocity:e.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...l,onUpdate:r})};if(e.attach((e,t)=>{n=e,r=e=>{var l,r;return t((l=e,(r=s)?l+r:l))},L.frame.postRender(c)},o),(0,eI.isMotionValue)(t)){let l=t.on("change",t=>{var l,r;return e.set((l=t,(r=s)?l+r:l))}),r=e.on("destroy",l);return()=>{l(),r()}}return o})(a,e,t),[a,JSON.stringify(t)]),a}(b,t);return u[1]!==w?(l={y:w},u[1]=w,u[2]=l):l=u[2],u[3]!==h?(i=h&&(0,r.jsx)(m.motion.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:f.INIT_DELAY+ +f.ANIMATION_DELAY},className:"w-full rounded-xl bg-white/40 p-3",children:(0,r.jsx)("img",{src:h,alt:"cover",className:"h-auto w-full rounded-xl border object-cover"})}),u[3]=h,u[4]=i):i=u[4],u[5]!==p?(n=p&&(0,r.jsxs)(m.motion.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:f.INIT_DELAY+2*f.ANIMATION_DELAY},className:"w-full rounded-xl border bg-white/40 p-3 text-sm",children:[(0,r.jsx)("h2",{className:"text-secondary mb-2 font-medium",children:"摘要"}),(0,r.jsx)("div",{className:"text-secondary cursor-text",children:p})]}),u[5]=p,u[6]=n):n=u[6],u[7]!==x?(s=(0,r.jsx)(eR,{toc:x,delay:f.INIT_DELAY+3*f.ANIMATION_DELAY}),u[7]=x,u[8]=s):s=u[8],u[9]!==y?(o=(0,r.jsx)(eS.default,{slug:y,delay:(f.INIT_DELAY+4*f.ANIMATION_DELAY)*1e3}),u[9]=y,u[10]=o):o=u[10],u[11]===Symbol.for("react.memo_cache_sentinel")?(c=(0,r.jsx)(eH,{delay:f.INIT_DELAY+5*f.ANIMATION_DELAY}),u[11]=c):c=u[11],u[12]!==l||u[13]!==i||u[14]!==n||u[15]!==s||u[16]!==o?(d=(0,r.jsxs)(m.motion.div,{className:"relative flex w-[200px] shrink-0 flex-col items-start gap-4 self-start max-sm:hidden",style:l,children:[i,n,s,o,c]}),u[12]=l,u[13]=i,u[14]=n,u[15]=s,u[16]=o,u[17]=d):d=u[17],d}function eF(e){return Math.max(0,e-72)}function ek(e){let t,l,i,n,s,o,c,d,u,g,h,p=(0,a.c)(28),{markdown:x,title:y,tags:v,date:b,summary:w,cover:N,slug:I}=e,{maxSM:_}=(0,H.useSize)(),{content:j,toc:O,loading:T}=(0,U.useMarkdownRender)(x);if(T){let e;return p[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,r.jsx)("div",{className:"text-secondary flex h-full items-center justify-center text-sm",children:"渲染中..."}),p[0]=e):e=p[0],e}return p[1]===Symbol.for("react.memo_cache_sentinel")?(t={opacity:0},l={opacity:1},i={delay:f.INIT_DELAY},p[1]=t,p[2]=l,p[3]=i):(t=p[1],l=p[2],i=p[3]),p[4]!==y?(n=(0,r.jsx)("div",{className:"text-center text-2xl font-semibold",children:y}),p[4]=y,p[5]=n):n=p[5],p[6]!==v?(s=v.map(eL),p[6]=v,p[7]=s):s=p[7],p[8]!==s?(o=(0,r.jsx)("div",{className:"text-secondary mt-4 flex flex-wrap items-center justify-center gap-3 px-8 text-center text-sm",children:s}),p[8]=s,p[9]=o):o=p[9],p[10]!==b?(c=(0,r.jsx)("div",{className:"text-secondary mt-3 text-center text-sm",children:b}),p[10]=b,p[11]=c):c=p[11],p[12]!==j?(d=(0,r.jsx)("div",{className:"prose mt-6 max-w-none cursor-text",children:j}),p[12]=j,p[13]=d):d=p[13],p[14]!==n||p[15]!==o||p[16]!==c||p[17]!==d?(u=(0,r.jsx)(m.motion.article,{initial:t,animate:l,transition:i,className:"card static flex-1 overflow-auto rounded-xl bg-white/80 p-8",children:(0,r.jsxs)("div",{children:[n,o,c,d]})}),p[14]=n,p[15]=o,p[16]=c,p[17]=d,p[18]=u):u=p[18],p[19]!==N||p[20]!==_||p[21]!==I||p[22]!==w||p[23]!==O?(g=!_&&(0,r.jsx)(eA,{cover:N,summary:w,toc:O,slug:I}),p[19]=N,p[20]=_,p[21]=I,p[22]=w,p[23]=O,p[24]=g):g=p[24],p[25]!==g||p[26]!==u?(h=(0,r.jsxs)("div",{className:"mx-auto flex max-w-[1140px] justify-center gap-6 px-6 pt-28 pb-12 max-sm:px-0",children:[u,g]}),p[25]=g,p[26]=u,p[27]=h):h=p[27],h}function eL(e){return(0,r.jsxs)("span",{children:["#",e]},e)}var eD=e.i(22315);function eW(e){let t,l,i,n,s,o,c,u=(0,a.c)(17),{form:f,coverPreviewUrl:g,onClose:h,slug:p}=e,x=function(){let e,t,l,r=(0,a.c)(9),{form:i,images:n}=d();if(r[0]!==i.md||r[1]!==n){for(let t of(e=i.md,n))if("file"===t.type){let l=`local-image:${t.id}`;e=e.split(`(${l})`).join(`(${t.previewUrl})`)}r[0]=i.md,r[1]=n,r[2]=e}else e=r[2];let s=e,o=i.title||"Untitled";r[3]!==i.date?(t=(0,eD.default)(i.date).format("YYYY年 M月 D日"),r[3]=i.date,r[4]=t):t=r[4];let c=t;return r[5]!==c||r[6]!==s||r[7]!==o?(l={markdown:s,title:o,date:c},r[5]=c,r[6]=s,r[7]=o,r[8]=l):l=r[8],l}(),y=g||void 0;return u[0]!==f.summary||u[1]!==f.tags||u[2]!==x.date||u[3]!==x.markdown||u[4]!==x.title||u[5]!==p||u[6]!==y?(t=(0,r.jsx)("div",{onClick:eP,children:(0,r.jsx)(ek,{markdown:x.markdown,title:x.title,tags:f.tags,date:x.date,summary:f.summary,cover:y,slug:p})}),u[0]=f.summary,u[1]=f.tags,u[2]=x.date,u[3]=x.markdown,u[4]=x.title,u[5]=p,u[6]=y,u[7]=t):t=u[7],u[8]===Symbol.for("react.memo_cache_sentinel")?(l={opacity:0,scale:.6},i={opacity:1,scale:1},n={scale:1.05},s={scale:.95},u[8]=l,u[9]=i,u[10]=n,u[11]=s):(l=u[8],i=u[9],n=u[10],s=u[11]),u[12]!==h?(o=(0,r.jsx)(m.motion.button,{initial:l,animate:i,whileHover:n,whileTap:s,className:"absolute top-4 right-6 rounded-xl border bg-white/60 px-6 py-2 text-sm",onClick:h,children:"关闭预览"}),u[12]=h,u[13]=o):o=u[13],u[14]!==t||u[15]!==o?(c=(0,r.jsxs)("div",{children:[t,o]}),u[14]=t,u[15]=o,u[16]=c):c=u[16],c}function eP(e){return e.stopPropagation()}function e$(){let e,t,l,i=(0,a.c)(8),{form:n,cover:s,reset:o}=d();i[0]!==o?(e=()=>o(),i[0]=o,i[1]=e):e=i[1],i[2]===Symbol.for("react.memo_cache_sentinel")?(t=[],i[2]=t):t=i[2],(0,g.useEffect)(e,t);let{isPreview:c,closePreview:m}=u(),f=s?"url"===s.type?s.url:s.previewUrl:null;return i[3]!==m||i[4]!==f||i[5]!==n||i[6]!==c?(l=c?(0,r.jsx)(eW,{form:n,coverPreviewUrl:f,onClose:m}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex h-full justify-center gap-6 px-6 pt-24 pb-12",children:[(0,r.jsx)(p,{}),(0,r.jsx)(j,{})]}),(0,r.jsx)(B,{})]}),i[3]=m,i[4]=f,i[5]=n,i[6]=c,i[7]=l):l=i[7],l}e.s(["default",()=>e$],84355)}]);